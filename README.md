# zip_tree

Python script for determining which directories to zip up to make total files per TiB come under a particular threshold.
Requires `tqdm` and `networkx`.

Takes a tab separated value file (or pipe) like where each row has the format `path/to/file<TAB>n_bytes`, e.g. as generated by

```sh
find . -type f --printf "%P\t%s\n"
```

and reconstructs the file hierarchy.
Then it descends into the hierarchy.
Subtrees with fewer files per TiB than a given threshold are skipped.
Subtrees whose total size is less than a given threshold are output and then skipped.

Motivation: some backup targets perform poorly or restrict dumps with lots of small files.
This script allows you to list directories which are good candidates to zipping up,
so that they can be ignored in your first dump, and then zip up and sync separately.

## Usage

```_help
usage: zip_tree.py [-h] [-t [TOTAL]] [-z MAX_ZIP_SIZE] [-l LIMIT_PER_TIB] [-P]
                   [input] [output]

positional arguments:
  input                 input file (empty or - to use stdin) with lines of
                        format `{filename}\t{n_bytes}`
  output                output file (empty or - to use stdout)

optional arguments:
  -h, --help            show this help message and exit
  -t [TOTAL], --total [TOTAL]
                        Total number of lines expected to add to graph, for
                        progress-reporting purposes. If `input` is a path AND
                        `total` is given without a value, the input file's
                        lines are counted with `wc -l` before processing.
  -z MAX_ZIP_SIZE, --max-zip-size MAX_ZIP_SIZE
                        Only directories whose contents are smaller than this
                        will be yielded, default 100.00GiB. Understands SI and
                        IEEE prefixes; bits and Bytes (default).
  -l LIMIT_PER_TIB, --limit-per-TiB LIMIT_PER_TIB
                        Directories with fewer descendants per tebibyte than
                        this will not be descended into, default 100000
  -P, --no-progress     Do not show progress bars
```
